# 監視戦略に望ましい機能

監視システムを選択する場合、重要な機能を理解し、優先順位を付けることが重要です。
さまざまな監視システムを評価する場合は、このセクションの特性を参考にして、要求に最適なソリューションを検討してください。
すでに監視戦略がある場合は、現在のソリューションの追加機能の使用を検討してください。
要求に応じて、1つの監視システムですべてのユースケースに対応することも、複数のシステムを組み合わせて使用することもできます。

## 速度

データの鮮度とデータ取得の速度に関しては、組織によってニーズが異なります。

データは必要なときに利用可能でなければなりません。鮮度は何か問題が発生したときに監視システムがあなたを呼び出してくれるまでの時間に影響します。
また、データの処理速度が遅いと、間違ったデータに誤って対処する可能性があります。
例えば、インシデント対応中に、原因(行動を起こすこと)と結果(そのアクションが監視に反映されていることを確認します。)の間の時間が長すぎると、変更には影響がなかったと想定したり、原因と結果の間に誤った相関関係があると推定したりする場合があります。
4~5分を超える古いデータは、インシデントへの迅速な対応に大きな影響を与える可能性があります。

この基準に基づいて監視システムを選択する場合は、事前に速度要件を把握する必要があります。
大量のデータをクエリする場合、データ取得の速度が大きな問題となります。
多数の監視対象システムから大量のデータを収集する必要がある場合、グラフの読み込みに時間がかかることがあります。
低速のグラフを高速化するには、監視システムが受信データに基づいて新しい時系列を作成して格納できると便利です。共通のクエリに対する回答を事前に計算することができます。

## 計算

計算のサポートは、複雑さの範囲を超えて、さまざまなユースケースにまたがることができます。
少なくとも、複数か月の期間にわたってデータを保持する必要があります。
データの長期的なビューがないと、システムの増加などの長期的な傾向を分析できません。
粒度の点では、サマリデータ(ドリルダウンできない集約データ)で十分に拡張計画を立てることができます。
個々の詳細な指標をすべて保持しておくと、「このような異常な振る舞いは以前にもありましたか？」といった質問に答えるのに役立ちます。
ただし、データを格納するにはコストがかかり過ぎるか、取得するには実用的でない場合があります。

イベントまたはリソース消費に関して保持するメトリクスは、カウンタが単調に増加するのが理想的です。
カウンタを使用すると、監視システムは時間の経過に伴ってウィンドウ関数を計算できます。例えば、カウンタからの1秒あたりのリクエスト数をレポートできます。
より長い時間枠(最大1か月)でこれらのレートを計算することで、SLOのバーンベースアラート([第5章](../../05_alerting-on-slos/README.md)参照)の構成要素を実装できます。

最後に、些細な操作が良くない振る舞いを隠蔽するかもしれないので、より完全な範囲の統計関数のサポートは、有用です。
レイテンシの記録時にパーセンタイル値(すなわち、50パーセンタイル、95パーセンタイル、99パーセンタイル)の計算をサポートする監視システムを使用すると、要求の50%、5%、1%のいずれかが遅すぎるかどうかを調べることができます。これに対して算術平均では、具体的な値は示されませんが、要求時間が遅いことのみわかります。
また、システムがパーセンタイルの計算を直接サポートしていない場合は、次の方法でこれを実現できます。

* リクエストに費やされた秒数を合計し、リクエスト数で割ることによる平均値の取得
* すべてのリクエストのロギングと、ログエントリのスキャンまたはサンプリングによるパーセンタイル値の計算

例えば、週次または月次レポートで使用したり、監視システムでは計算が難しいような複雑な計算を実行するために、未加工のメトリックデータをオフライン分析用に別システムに記録できます。
