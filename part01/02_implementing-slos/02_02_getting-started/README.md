# 入門

SLOの基本セットを確立するための出発点として、あなたのサービスはコンパイル、リリースされ、ユーザがWeb経由でアクセスするネットワークインフラストラクチャ上で実行されている何らかの形式のコードであるとしましょう。
あなたのシステムの成熟度は、次のいずれかであると思われます。

* 何もデプロイされていない未知の開発
* 何らかの監視が必要なシステムで、問題が発生したときに通知しますが、正式な目標、エラー・バジェットの概念はなく、暗黙的に稼働率100％を目標としている
* SLOが100％を下回る稼働中のデプロイメントですが、SLOの重要性や継続的な改善の選択にSLOを使用する方法に関する一般的な理解がない、すなわち中身のないSLO

サイトリライアビリティエンジニアリングにエラー・バジェットに基づくアプローチを採用するには、次のことに当てはまる状態に到達する必要があります。

* 組織のすべてのステークホルダーがプロダクトに適していると認定したSLOがあること。
* サービスがそのSLOを満たすことを保証する責任を負う人々が、通常状態でこのSLOを満たすことが可能であることに同意していること。
* 意思決定と優先順位決定にエラー・バジェットを使用することを組織が約束しています。この約束は、エラー・バジェットポリシーのなかで正式化なものにされていること。
* SLOを洗練するためのプロセスがあること。

そうでなければ、信頼性に対するエラー・バジェットに基づくアプローチを採用することができなくなります。
SLOの遵守が意思決定ツールというよりも、単なる別のKPI(重要業績評価指標)またはレポートメトリックになるでしょう。

## 信頼性目標とエラー・バジェット

適切なSLOを定式化するための最初のステップは、SLOが何であるべきか、そしてそれがカバーすべきものについて話すことです。

SLOは、サービスの顧客に対して信頼性の目標レベルを設定します。
この閾値を超えると、ほぼすべてのユーザがサービスに満足している必要があります(サービスの利用にさもなければ満足していると仮定します)。【2】
この閾値を下回ると、ユーザーは不平を言ったり、サービスの使用をやめたりする可能性が高くなります。
結局のところ、ユーザの満足は重要です。満足しているユーザはサービスを使用し、組織の収益を生み出し、顧客サポートチームへの需要を抑え、友人にサービスを推薦します。
私たちは、顧客満足を保つために信頼できるサービスを提供し続けます。

顧客満足はかなり曖昧な概念です。正確に測定することはできません。
大抵の場合、それについての見通しがほとんどありません。そのため、どうやって始めますか。最初のSLOには何を使用しますか。

我々の経験から、信頼性100％が間違った目標であることが示されています。

* SLOが顧客満足度と一致する場合、100％は合理的な目標ではありません。冗長コンポーネント、自動ヘルスチェックおよび高速フェイルオーバーがあっても、1つ以上のコンポーネントが同時に故障する可能性はゼロでないため、結果として100％未満の可用性になります。
* 利用しているシステムに100％の信頼性を達成できたとしても、顧客は100％の信頼性を経験することはないでしょう。あなたと顧客間のシステム的な繋がりは、大抵長くて複雑であり、これらのコンポーネントのいずれかが失敗する可能性があります。【3】これはまた、あなたが99％から99.9％、そして99.99％の信頼性に向かうにつれて、追加の9は増加コストになりますが、顧客に対する限界効用は着実にゼロに近づくことを意味しています。
* 顧客が100％信頼できる経験を構築し、その水準の信頼性を維持したい場合はサービスを更新または改善することはできません。新機能の導入、セキュリティパッチの適用、新しいハードウェアの導入、顧客の需要を満たすためのスケーリングは、その100％の目標に影響を与えます。遅かれ早かれ、あなたのサービスは停滞し、顧客は他のどこかへ行ってしまうでしょう。これはどこにおいても良いことではありません。
* 100％のSLOは、後手に回る時間しかないことを意味します。文字通り、100％未満の可用性に対応する以外は何もできません。そして、これは確実に発生します。100％の信頼性はエンジニアリング文化のSLOではありません。運用チームのSLOです。

一度100％未満のSLO目標を設定したら、機能のベロシティと信頼性のトレードオフを行う権限を持つ組織内の誰かが所有する必要があります。
小規模な組織においてはCTOかもしれません。大規模な組織では、通常プロダクトオーナー(またはプロダクトマネージャ)です。

## 何を測定するか：SLIの使用

100％が間違った数値であることに賛成するとして、正しい数値をどのように決定しますか。
いずれにせよ、あなたは何を測定していますか。
ここで、サービスレベル指標が有効になります。SLIとは、提供しているサービスレベルの指標です。

多くの数値はSLIとして機能することができますが、通常であればSLIを2つの数値の比率として扱うことを推奨します。
良いイベント数をイベントの総数で割ったものです。以下に例を記載します。

* 成功したHTTPリクエスト数/HTTPリクエスト総数(成功率)
* 100ms以内で正常終了したgRPCコール数/gRPCリクエスト総数
* コーパス全体を使用した検索結果数/正常に機能しなかったものを含む検索結果の総数
* 10分よりも新しい在庫データを使用したプロダクト検索者からの「在庫確認件数」リクエスト数/在庫確認の総数
* そのメトリクスのために何かしら拡張した基準のリストに基づいた「良いユーザ時間」数/ユーザ時間の総数

このような形式のSLIは、特に便利な性質がいくつかあります。
SLIの範囲は0％から100％で、0％は一切作用しないことを意味し、100％は何も問題が起きていないことを意味します。
この尺度は直感的であり、この形式そのものが簡単にエラー・バジェットの概念に役立ちます。
SLOは目標のパーセンテージで、エラー・バジェットはSLOを100％引いたものです。
例えば、成功率99.9％のSLOを設定した場合、4週間に300万件のリクエストを受信するサービスは、その期間に3,000(0.1％)件のエラー・バジェットを保有します。
1回の停止で1,500個のエラーが発生する場合、そのエラーはエラー・バジェットの50％を費やします。

さらに、すべてのSLIを一貫した形式にすることでツールにより良い利点をもたらすことができます。
アラートロジックやSLO分析ツール、エラー・バジェット計算、および分子、分母、閾値等の同じ入力値のレポートツールを作成できます。
簡略化はここではおまけです。

初めてSLIを策定しようとするときに、SLIをSLI仕様とSLI実装にさらに分けることが有用な場合があります。

_SLI仕様_  
どのように計測されるかにかかわらず、ユーザーにとって重要と考えるサービスの結果に対する評価。

例：100ミリ秒以内で読み込まれたホームページへのリクエストの割合

_SLI実装_  
SLI仕様とその計測方法。

例：

* サーバログのレイテンシ列から測定された100ミリ秒以内で読み込まれたホームページへのリクエストの割合。この計測では、バックエンドに届かないリクエストは見逃される。
* 仮想マシンで実行されているブラウザでJavaScriptを実行するproberによって測定された100ミリ秒以内で読み込まれたホームページへのリクエストの割合。この計測では、リクエストがネットワークに届かない場合にエラーを検出しますが、一部のユーザのみに影響を与える問題を見逃す可能性があります。
* ホームページ上のJavaScript実装で計測された100ミリ秒以内で読み込みされたホームページへのリクエストの割合。専用のテレメトリ記録サービスに戻って報告されます。この計測では、ユーザーエクスペリエンスをより正確に把握できますが、この情報を捕捉するためにコードを修正して、それを記録するためのインフラストラクチャを構築する必要があります。独自の信頼性要件を持つ仕様です。

上記のように、単一のSLI仕様にはSLI実装が複数存在する場合があり、品質(顧客エクスペリエンスをいかに正確に把握するか)、カバレッジ(すべての顧客のエクスペリエンスをどうやってうまく把握するか)、コストの点で各々メリットとデメリットが存在します。

SLIとSLOに対するはじめの試みが正しいとは限りません。
つまり、最も重要な目的は、何らかを取得して計測し、改善できるようにフィードバックループを設定することです。([34ページの「SLO目標の継続的な改善」](../02_06_continuous-improvement-of-slo-targets/README.md)でこのトピックの詳細を説明します。)

[最初の本](http://bit.ly/2kIcNYM)では、現在のパフォーマンスに基づいてSLOを選択しないように忠告しています。これは、不必要に厳しいSLOにつながる可能性があるためです。
その忠告は正しいのですが、他の情報がない場合やイテレーションを行うプロセスが適切な場合は、現在のパフォーマンスから開始するのが良いです(後で説明します)。
しかし、SLOを洗練するにつれて現在のパフォーマンスを制限してはいけません。
顧客はサービスがSLOで実行されることを期待しているでしょう。したがって、サービスが10ミリ秒未満で99.999％の成功リクエストを返す場合、そのベースラインから大きく退行してしまうと、ユーザたちを不幸にしてしまうかも知れません。

最初の一連のSLOを作成するには、サービスにとって重要ないくつかの重要なSLI仕様を決定する必要があります。
可用性とレイテンシSLOは非常に一般的です。新鮮さ、耐久性、正確性、品質、およびカバレッジのSLOにも余地があります(後で詳しく説明します)。

どのような種類のSLIを使い始めるのかがわからない場合は、シンプルに始めることが役に立ちます。

* SLOを定義するアプリケーションを1つ選択します。 プロダクトに多くのアプリケーションが含まれている場合は、後で追加することができます。
* この状況で「ユーザ」が誰であるかを明確に決定します。あなたが最適化することで喜ぶ人々のことです。
* ユーザがシステムとやりとりする一般的な作業(共通タスクや重要な活動)を考慮してください。
* システムのハイレベルアーキテクチャ図を描きます。主要コンポーネント、リクエストフロー、データフローおよび重要な依存関係を示します。これらのコンポーネントを次のセクションに一覧化されているカテゴリにグループ化します(重複して曖昧になるかも知れませんが、あなたの直感を使って、完璧を求めすぎて本末転倒にならないようにしてください)。

あなたがSLIとして選択したものについて正確に考えるべきですが、過度に複雑にするべきではありません。
特にSLIを始めたばかりの場合は、システムに関連はあるが測定が容易な要素を選択してください。後でいつでも繰り返して洗練することができます。

----------
【2】これはサービスレベルアグリーメント(SLA)とは異なります。これは、ユーザが不満であるために何らかの形で補償する必要がある場合に有効になるビジネス上の契約です。

【3】依存関係をサービスの信頼性に分解することに関する詳細については、Ben Treynor、Mike Dahlin、Vivek Rau、およびBetsy Beyer『The Calculus of Service Availability』ACM Queue 15, no.2(2017) [https://queue.acm.org/detail.cfm?id=3096459](https://queue.acm.org/detail.cfm?id=3096459)を参照してください。

【4】四半期等のカレンダー期間にSLOを測定すると、トラフィック等の予測不可能なメトリクスに基づいている場合は、四半期の終わりにバジェットがどれだけ大きくなるか分からないことがあります。報告期間の詳細については、[29ページの「適切なタイムウィンドウの選択」](../02_04_choosing-an-appropriate-time-window/README.md)を参照してください。
